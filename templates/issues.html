{% extends 'base.html' %}

{% block title %}Issues Management{% endblock %}

{% block content %}
    <div class="content-header">
        <div class="content-header-left">
            <h2>Issues Management</h2>
            <p>All active and open issues in your arcade.</p>
        </div>
    </div>

    {# Collapsible section for adding a new issue #}
    <section class="section-card collapsible-section">
        <div class="collapsible-header" id="addNewIssueToggle">
            <h3>Add New Issue</h3>
            <i class="fas fa-plus toggle-icon"></i> {# Plus icon for "add" #}
        </div>
        <div class="collapsible-content">
            <form id="addNewIssueForm" class="form-grid"> {# Added form-grid for better layout #}
                <div class="form-group">
                    <label for="newIssueEquipmentLocation">Equipment / Location:</label>
                    <input type="text" id="newIssueEquipmentLocation" name="equipment_location" class="form-input" placeholder="e.g., Skee-Ball Lane 3, Front Door" required>
                </div>
                <div class="form-group">
                    <label for="newIssueDescription">Problem Description:</label>
                    <textarea id="newIssueDescription" name="description" class="form-textarea" rows="3" placeholder="e.g., Ball return jammed, Lock is loose" required></textarea>
                </div>
                <div class="form-group">
                    <label for="newIssueArea">Area:</label>
                    <select id="newIssueArea" name="area" class="form-select" required>
                        <option value="">Select Area</option>
                        <option value="Arcade">Arcade</option>
                        <option value="Restroom">Restroom</option>
                        <option value="Kitchen">Kitchen</option>
                        <option value="Showroom">Showroom</option>
                        <option value="Backroom">Backroom</option>
                        <option value="Exterior">Exterior</option>
                        <option value="Office">Office</option>
                        <option value="Adventure Zone">Adventure Zone</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="newIssueCategory">Category / Type:</label>
                    <select id="newIssueCategory" name="category" class="form-select" required>
                        <option value="">Select Category</option>
                        <option value="Lighting">Lighting</option>
                        <option value="Safety">Safety</option>
                        <option value="Cosmetic">Cosmetic</option>
                        <option value="Mechanical">Mechanical</option>
                        <option value="Electrical">Electrical</option>
                        <option value="Plumbing">Plumbing</option>
                        <option value="Cleaning">Cleaning</option>
                        <option value="Software">Software</option>
                        <option value="HVAC">HVAC</option>
                        <option value="Structural">Structural</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="newIssuePriority">Priority:</label>
                    <select id="newIssuePriority" name="priority" class="form-select" required>
                        <option value="">Select Priority</option>
                        <option value="IMMEDIATE">IMMEDIATE</option>
                        <option value="High">High</option>
                        <option value="Medium">Medium</option>
                        <option value="Low">Low</option>
                        <option value="CLEANING">CLEANING</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="newIssueAssignedTo">Assigned To:</label>
                    <input type="text" id="newIssueAssignedTo" name="assigned_to" class="form-input" placeholder="e.g., Tech, Self, Contractor">
                </div>
                <button type="submit" class="add-task-button form-submit-button">Submit New Issue</button>
            </form>
        </div>
    </section>
    
    <section class="section-card">
        <div class="section-card-header-with-toolbar"> {# NEW: Wrapper for title and toolbar #}
            <h2>Current Issues</h2>
            {# --- NEW CODE HERE --- #}
            {# Compact Issues Toolbar #}
            <div class="issues-toolbar-compact" id="issuesToolbarCompact">
                <div class="toolbar-toggle" id="issuesToolbarToggle">
                    <i class="fas fa-chevron-down toggle-icon"></i>
                </div>
                <div class="toolbar-buttons-group">
                    {# Placeholder for future buttons like Align, Filter, Sort, etc. #}
                    <button class="toolbar-button" data-action="align-left" title="Align Left"><i class="fas fa-align-left"></i></button>
                    <button class="toolbar-button" data-action="align-center" title="Align Center"><i class="fas fa-align-center"></i></button>
                    <button class="toolbar-button" data-action="align-right" title="Align Right"><i class="fas fa-align-right"></i></button>
                    {# Add more buttons here as needed #}
                </div>
            </div>
            {# --- END NEW CODE --- #}
        </div>
        <div class="table-responsive">
            <table class="issues-table">
                <thead>
                    <tr>
                        <th>Issue ID <div class="resizer"></div></th>
                        <th>Priority <div class="resizer"></div></th>
                        <th>Date Added <div class="resizer"></div></th>
                        <th>Last Update <div class="resizer"></div></th>
                        <th>Area <div class="resizer"></div></th>
                        <th>Equipment Name <div class="resizer"></div></th>
                        <th>Problem Description <div class="resizer"></div></th>
                        <th>Notes <div class="resizer"></div></th>
                        <th>Status <div class="resizer"></div></th>
                        <th>Target Date <div class="resizer"></div></th>
                        <th>Assigned Employee <div class="resizer"></div></th>
                        <th></th> {# No resizer for the last column (options menu) #}
                    </tr>
                </thead>
                <tbody id="issuesTableBody">
                </tbody>
            </table>
        </div>
        <p id="noIssuesMessage" style="text-align: center; padding: 20px; display: none; color: var(--text-color-light);">No active issues found.</p>
    </section>
    {# Floating toolbar for column alignment options (will be removed later) #}
    <div id="columnAlignmentToolbar" class="column-toolbar hidden">
        <button class="toolbar-button" data-align="left" title="Align Left"><i class="fas fa-align-left"></i></button>
        <button class="toolbar-button" data-align="center" title="Align Center"><i class="fas fa-align-center"></i></button>
        <button class="toolbar-button" data-align="right" title="Align Right"><i class="fas fa-align-right"></i></button>
    </div>
{% endblock %}

<link rel="stylesheet" href="{{ url_for('static', filename='css/components/issues_table_menu.css') }}">
<script type="module" src="{{ url_for('static', filename='js/modules/issueOptions.js') }}"></script>
<script type="module" src="{{ url_for('static', filename='js/modules/issuesTable.js') }}"></script>
