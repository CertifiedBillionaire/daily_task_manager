{% extends 'base.html' %}

{% block title %}Arcade Manager Dashboard{% endblock %}

{% block content %}
  <div class="content-header">
    <div class="dashboard-overview-header">
      <div class="content-header-left">
        <h2>Arcade Operations Overview</h2>
        <p id="currentDayDate">Sunday, July 27, 2025</p>
      </div>
      <div class="urgent-issue">
        <i class="fas fa-exclamation-triangle"></i>
        <span id="urgentIssue">No Urgent Issues</span>
      </div>
    </div>
  </div>

  <div class="dashboard-grid">
    <!-- Opening Checklist -->
    <div class="dashboard-card action-card color-yellow" id="startOpeningChecklist" data-id="opening-checklist" data-color="yellow">
      <div class="card-menu-container">
        <button class="card-menu-button">
          <i class="fa-solid fa-ellipsis-vertical"></i>
        </button>
        <div class="card-menu">
          <ul>
            <li data-action="reset-checklist">Reset Progress</li>
          </ul>
        </div>
      </div>

      <div class="card-content-top">
        <div class="card-icon"><i class="fa-solid fa-list-check"></i></div>
        <div class="card-text-group">
          <h3>Start Opening Checklist</h3>
          <p class="card-description">Begin your daily opening routine.</p>
        </div>
      </div>

      <div class="card-desktop-menu">
        <span data-action="reset-checklist">• Reset Progress</span>
      </div>

      <div class="card-progress">19/19 Done</div>
    </div>

    <!-- Inspect a Game -->
    <div class="dashboard-card action-card color-blue" id="inspectArcadeGame">
      <div class="card-menu-container">
        <button class="card-menu-button">
          <i class="fa-solid fa-ellipsis-vertical"></i>
        </button>
        <div class="card-menu">
          <ul>
            <li data-action="inspect-all">Inspect All</li>
            <li data-action="reset-progress">Reset Progress</li>
          </ul>
        </div>
      </div>

      <div class="card-content-top">
        <div class="card-icon"><i class="fa-solid fa-book"></i></div>
        <div class="card-text-group">
          <h3>Inspect a Game</h3>
          <p class="card-description">Perform a detailed check on a single game.</p>
        </div>
      </div>

      <div class="card-desktop-menu">
        <span data-action="inspect-all">• Inspect All</span>
        <span data-action="reset-progress">• Reset Progress</span>
      </div>

      <div class="card-progress">0/53 Done</div>
    </div>

    <!-- Log a New Issue (live counts + click opens quick-add modal) -->
    <div class="dashboard-card action-card color-orange card-clickable" id="addNewIssueCard" tabindex="0" aria-label="Log a New Issue">
      <!-- floating + button -->
      <button class="card-fab" id="addIssueFab" type="button" aria-label="Add new issue">
        <i class="fa-solid fa-plus"></i>
      </button>

      <div class="card-content-top">
        <div class="card-icon"><i class="fa-solid fa-circle-plus"></i></div>
        <div class="card-text-group">
          <h3>Log a New Issue</h3>
          <p class="card-description">Quickly log a new issue.</p>
        </div>
      </div>

      <div class="card-metrics">
        <div class="metric">
          <div class="metric-label">Open</div>
          <div class="metric-value" id="issuesOpenCount">—</div>
        </div>
        <div class="metric">
          <div class="metric-label">Awaiting Parts</div>
          <div class="metric-chip" id="issuesAwaitingPartsCount">—</div>
        </div>
      </div>
    </div>
    <!-- Log PMs -->
    <div class="dashboard-card action-card color-green" id="addPMCard">
      <div class="card-content-top">
        <div class="card-icon"><i class="fa-solid fa-list-check"></i></div>
        <div class="card-text-group">
          <h3>Log PMs</h3>
          <p class="card-description">Log completed preventative maintenance.</p>
        </div>
      </div>
    </div>

    <!-- Update Down Games -->
    <div class="dashboard-card action-card color-red card-clickable" id="downGamesCard" tabindex="0" aria-label="Update Down Games">
      <div class="card-content-top">
        <div class="card-icon"><i class="fa-solid fa-gamepad"></i></div>
        <div class="card-text-group">
          <h3>Update Down Games</h3>
        </div>
      </div>

      <div class="down-games-metrics">
        <div class="metric">
          <div class="metric-label">Down</div>
          <div class="metric-value" id="downGamesCount">—</div>
        </div>
        <div class="metric">
          <div class="metric-label">Uptime</div>
          <div class="metric-chip" id="downGamesUptime">--%</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Simple modal: Update Down Games -->
  <div id="downGamesModal" class="simple-modal" hidden>
    <div class="simple-modal__overlay" data-close></div>
    <div class="simple-modal__panel" role="dialog" aria-modal="true" aria-labelledby="dgm-title">
      <div class="simple-modal__header">
        <h3 id="dgm-title">Update Down Games</h3>
        <button class="simple-modal__close" type="button" aria-label="Close" data-close>&times;</button>
      </div>
      <div class="simple-modal__body" id="dgm-body"></div>
    </div>
  </div>

  <!-- Simple modal: Quick Add Issue -->
  <div id="addIssueModal" class="simple-modal" hidden>
    <div class="simple-modal__overlay" data-close></div>
    <div class="simple-modal__panel" role="dialog" aria-modal="true" aria-labelledby="ai-title">
      <div class="simple-modal__header">
        <h3 id="ai-title">Log a New Issue</h3>
        <a href="/issues" class="ai-link">Open full Issues page</a>
        <button class="simple-modal__close" type="button" aria-label="Close" data-close>&times;</button>
      </div>
      <div class="simple-modal__body">
        <form id="ai-form" class="ai-form" autocomplete="off">
          <div class="ai-row">
            <label for="ai-desc">Description <span class="req">*</span></label>
            <textarea id="ai-desc" rows="3" placeholder="What’s wrong?" required></textarea>
          </div>

          <div class="ai-grid">
            <div class="ai-col">
              <label for="ai-priority">Priority</label>
              <select id="ai-priority">
                <option value="Medium">Medium</option>
                <option value="High">High</option>
                <option value="IMMEDIATE">IMMEDIATE</option>
                <option value="Low">Low</option>
                <option value="CLEANING">CLEANING</option>
              </select>
            </div>
            <div class="ai-col">
              <label for="ai-area">Area</label>
              <input id="ai-area" type="text" placeholder="e.g., Game Room">
            </div>
          </div>

          <div class="ai-grid">
            <div class="ai-col">
              <label for="ai-equip">Equipment/Location</label>
              <input id="ai-equip" type="text" placeholder="e.g., Pac-Man, Aisle 3">
            </div>
            <div class="ai-col">
              <label for="ai-notes">Notes</label>
              <input id="ai-notes" type="text" placeholder="Optional notes">
            </div>
          </div>

          <div class="ai-actions">
            <button id="ai-submit" type="submit" class="ai-btn">Add Issue</button>
          </div>
        </form>
      </div>
    </div>
  </div>
{% endblock content %}

{% block scripts %}
  {{ super() }}
  <script type="module" src="{{ url_for('static', filename='js/modules/dashboardDownGamesCard.js') }}"></script>
  <script type="module" src="{{ url_for('static', filename='js/modules/downGamesQuickUpdate.js') }}"></script>
  <script type="module" src="{{ url_for('static', filename='js/modules/dashboardIssuesCard.js') }}"></script>
  <script type="module" src="{{ url_for('static', filename='js/modules/dashboardIssuesQuickAdd.js') }}"></script>
{% endblock %}